$(document).ready(function(){$.event.props=$.event.props.join("|").replace("layerX|layerY|","").split("|");$("#appName").html(parent.global.appName+"<span>V"+parent.global.appVersion+"</span>");$("#appIcon").html('<img src="'+parent.global.appIconUrl+'" onerror="appImgError(this)"/>');$("#appVersion").text("版本："+parent.global.appVersion);var c='<div style="display:none" packageName="'+parent.global.packageName+'" downloadUrl="'+parent.global.downloadUrl+'" appName="'+parent.global.appName+'"></div>';var a=parent.global.packageName;var b=a.replace(/\./g,"");if(parent.global.status=="立即更新"||parent.global.status=="立即安装"){$("#downloadBtn").html('<div class="download '+b+'" id="'+parent.global.packageName+'" onmousedown="install(this)">'+parent.global.status+"</div>").prepend(c)}else{if(parent.global.cateId=="ads"){$("#downloadBtn").html('<div class="download" onmousedown="install(this)">立即安装</div>')}else{$("#downloadBtn").html('<div class="download unable '+b+'" id="'+parent.global.packageName+'" onmousedown="install(this)">'+parent.global.status+"</div>").prepend(c)}}$("#appSubmitButton").click(function(){if(!$(this).hasClass("disable")){var e=jstrim($("#appDiscuz").val());var d=$("#appDiscuzProfile").find(".discuzStarOn").length;if(e!=""){$("#appSubmitPrompt").html('正在提交评论，请稍候<img src="images/submiting.gif"/>');parent.submitDiscuss(e,d)}else{$("#appSubmitPrompt").html("提交的内容不能为空！")}}})});var global={bannerObj:""};window.onload=function(){parent.iframeGetDetail()};function myfocus(){}function jstrim(a){return a.replace(/^\s+|\s+$/g,"")}function star(d){d=$(d);if(!d.hasClass("discuzStarOn")){d.addClass("discuzStarOn")}var c,e,b=0;c=d.next();e=d.prev();b=0;while(c.hasClass("discuzStar")){c.removeClass("discuzStarOn");c=c.next();b++;if(b>=5){break}}b=0;while(e.hasClass("discuzStar")){if(!e.hasClass("discuzStarOn")){e.addClass("discuzStarOn")}e=e.prev();b++;if(b>=5){break}}var a=$(".discuzStarOn").length;if(a==1){document.getElementById("discussLevel").innerText=" 很烂!"}else{if(a==2){document.getElementById("discussLevel").innerText=" 不喜欢!"}else{if(a==3){document.getElementById("discussLevel").innerText=" 一般!"}else{if(a==4){document.getElementById("discussLevel").innerText=" 不错!"}else{if(a==5){document.getElementById("discussLevel").innerText=" 非常喜欢!"}}}}}}function pageselectCallback(a,b){a=a+1;parent.getDiscuss(a);document.getElementById("discuzList").innerHTML='<div class="appPrompt">正在加载</div>';return false}function initPagination(c,a){var b=c;$("#discuzPage").pagination(b,{callback:pageselectCallback,items_per_page:1,current_page:a,next_show_always:true,prev_show_always:true,next_text:"下一页",prev_text:"上一页"})}document.oncontextmenu=new Function("return false;");function setAppDetail(n){if(n!=""&&n!=null&&n!="0"){var o=parseInt(n[0]["score"],10);var a="",q="";while(o--){a+='<div class="appInfoLevelOn"></div>'}o=parseInt(n[0]["size"],10);o=o/1024;o=o.toFixed(2);document.getElementById("appInfo").innerHTML=n[0]["info"];document.getElementById("appSize").innerText="大小："+o+"M";document.getElementById("appTime").innerText=n[0]["uploadTime"];document.getElementById("appLevel").innerHTML=a;if(n[0]["titleZh"]!=null){parent.global.appName=n[0]["titleZh"];$("#appName").html(parent.global.appName+"<span>V"+n[0]["versionName"]+"</span>")}if(n[0]["iconUrl"]!=null){parent.global.appIconUrl=n[0]["iconUrl"];$("#appIcon").html('<img src="'+parent.global.appIconUrl+'" onerror="appImgError(this)"/>')}if(n[0]["developer"]!=null){parent.global.appDev=n[0]["developer"]}if(n[0]["ratersCount"]!=null){parent.global.appRaterCnt=n[0]["ratersCount"];$("#discuzNum").text(parent.global.appRaterCnt)}else{parent.global.appRaterCnt=0;$("#discuzNum").text(parent.global.appRaterCnt)}if(n[0]["versionName"]!=null){$("#appVersion").text("版本："+n[0]["versionName"])}if(n[0]["packageName"]!=null){parent.global.packageName=n[0]["packageName"]}if(n[0]["downloadUrl"]!=null){parent.global.downloadUrl=n[0]["downloadUrl"]}if(n[0]["downloadCount"]!=null){if(n[0]["downloadCount"]!="-1"){var g=document.getElementById("appDownloadCount");g.style.display="block";g.innerText="下载："+n[0]["downloadCount"]+"次"}else{document.getElementById("appDownloadCount").style.display="none"}}else{document.getElementById("appDownloadCount").style.display="none"}var l='<div style="display:none" packageName="'+parent.global.packageName+'" downloadUrl="'+parent.global.downloadUrl+'" appName="'+parent.global.appName+'"></div>';var d=parseInt(n[0]["status"],10);var b=getButtonStatus(d,parent.global.packageName);$("#downloadBtn").html(b).prepend(l);setDetailButtonStatus(d,parent.global.packageName);var k=n[1].length;var c=0;for(var f=0;f<k;f++){q+='<li><div class="imgDiv l"><img src="'+n[1][f]["img"]+'" onerror="appImgError(obj)"/></div>';if(++f<k){q+='<div class="imgDiv r"><img src="'+n[1][f]["img"]+'" onerror="appImgError(obj)"/></div>'}q+="</li>"}q="<ul>"+q+"</ul>";var e=$("#banner");e.html(q);var p=e.unslider({speed:500,delay:3000,complete:function(){},keys:true,dots:true,fluid:false});global.bannerObj=p.data("unslider");var h=parseInt(parent.global.appRaterCnt,10);var m=Math.ceil(h/6);if(m>1){initPagination(m,0)}parent.getDiscuss(1)}else{if(n=="0"){document.getElementById("appInfo").innerHTML='<div class="appBusy">网络异常，加载失败！</div>'}else{document.getElementById("appInfo").innerHTML='<div class="appBusy">应用没有相关介绍！</div>'}$("#appDiscuz").attr("disabled","disabled").attr("placeholder","您还未安装该应用，不能进行评论！").val("");$("#appSubmitButton").addClass("disable")}}function setDiscuss(b){if(b!=""&&b!=null&&b!="0"){var a="<ul>";for(var c=0;c<b.length;c++){nScore=parseInt(b[c]["score"],10);csScore="";while(nScore--){csScore+='<div class="appInfoLevelOn"></div>'}a+='<li>                    	    <div style="margin-left:25px;">                                <div class="appInfoLevel">'+csScore+'</div>                                <div class="discuzTime">评论于：'+b[c]["time"]+'</div>                            </div>                    	    <div class="discuzInfo">'+b[c]["txt"]+"</div>                    	</li>"}a+="</ul>";$("#discuzList").html(a)}else{if(b=="0"){document.getElementById("discuzList").innerHTML='<div class="appBusy">网络异常，加载失败！</div>'}else{document.getElementById("discuzList").innerHTML='<div class="empty">应用没有相关评论！</div>'}}}function submitDiscussSuccess(a){if(a=="1"){$("#appDiscuz").val("");a="评论提交成功！";parent.global.appRaterCnt=parseInt(parent.global.appRaterCnt,10)+1;$("#discuzNum").text(parent.global.appRaterCnt)}else{a="提交评论失败，请重新提交！"}$("#appSubmitPrompt").text(a)}function setAppDetailTop10(c){var e=$("#hotApp");var h="",g="",j="",a="",b="-1";if(c!=""&&c!=null){if(f=="0"){return}var h="";var f=c.appList;for(var d=0;d<f.length;d++){g=parseInt(f[d]["score"],10);a=g;b=f[d]["downloadCount"];if(b!="-1"){b="下载<span>"+formatNum(b)+"</span>次"}else{b="评论<span>"+f[d]["raterCnt"]+"</span>次"}g=f[d]["status"];j=getButtonStatus(g,f[d]["csPackageName"]);h+='<div class="appHotList" id="'+f[d]["id"]+'" onmousedown="appClick(this)">                <div class="appHotListImg"><img src="'+f[d]["iconUrl"]+'" onerror="appImgError(this)"/></div>                <div><div class="appHotListName">'+f[d]["titleCN"]+'</div>                <div class="appHotListDev" score="'+a+'" appDev="'+f[d]["developer"]+'" version="'+f[d]["versionName"]+'" downloadUrl="'+f[d]["downloadUrl"]+'" appName="'+f[d]["titleCN"]+'"                  >'+b+"</div>"+j+"</div></div>"}e.after(h)}}function countNum(d,c){var e=d.value;var b=d.value.length;if(b>c){d.value=e.substring(0,c);e=d.value;b=e.length}var a="(允许您输入"+c+"个字符)";if(b==0){a="(允许您输入"+c+"个字符)"}else{b=c-b;if(b==0){a="(您已经不能进行输入了)"}else{a="(您还可以输入"+b+"个字符)"}}document.getElementById("canInput").innerText=a}function bannerPrev(){if(global.bannerObj==""){return}global.bannerObj.prev()}function bannerNext(){if(global.bannerObj==""){return}global.bannerObj.next()}function showDetail(b){b=$(b);var a=$("#appInfo").height()-60;if(b.text()=="展开"){b.removeClass("down");b.text("收起");b=$("#top");var c=b.height()+a;b.height(c);b=$("#mid");c=parseInt(b.css("top"))+a;b.css("top",c+"px");$("#appInfo").css("overflow-y","auto")}else{b.addClass("down");b.text("展开");b=$("#top");var c=b.height()-a;b.height(c);b=$("#mid");c=parseInt(b.css("top"))-a;b.css("top",c+"px");b=document.getElementById("appInfo");b.scrollTop=0;$(b).css("overflow-y","hidden")}};