window.onload=function(){parent.initPhoneNeed();refreshTopicList()};var global={refreshTime:0};function appImgError(a){a.parentNode.innerHTML='<div class="imgError"><div>'}function InstallOrUpdateSuccess(b,a){var d=a.replace(/\./g,"");d=d.replace(/^\s+|\s+$/g,"");if(d==""){return}var c=$("."+d);if(b=="-1"){c.addClass("unable").html('<img src="../images/doing.gif"/><span>下载中</span>')}else{if(b=="5"){c.addClass("unable").html('<img src="../images/doing.gif"/><span>安装中</span>')}else{if(b=="4"){c.addClass("unable").html("已安装")}else{if(b=="3"){c.removeClass("unable").html("立即更新")}else{c.removeClass("unable").html("立即安装")}}}}}function getButtonStatus(b,a){var c="";var d=a.replace(/\./g,"");if(b=="1"){c='<div class="pnD unable '+d+'" id="'+a+'" onmousedown="install(this)"><img src="../images/doing.gif"/><span>下载中</span></div>'}else{if(b=="5"){c='<div class="pnD unable '+d+'" id="'+a+'" onmousedown="install(this)"><img src="../images/doing.gif"/><span>安装中</span></div>'}else{if(b=="3"){c='<div class="pnD '+d+'" id="'+a+'" onmousedown="install(this)">立即更新</div>'}else{if(b=="4"){c='<div class="pnD unable '+d+'" id="'+a+'" onmousedown="install(this)">已安装</div>'}else{c='<div class="pnD '+d+'" id="'+a+'" onmousedown="install(this)">立即安装</div>'}}}}return c}function install(g){if(event.button==2){return}var c=g.id;var e=c.replace(/\./g,"");var d=$("."+e);d.addClass("unable");if(g.innerText=="立即安装"||g.innerText=="立即更新"){d.html('<img src="../images/doing.gif"/><span>下载中</span>')}else{return true}var c="",f="",a="",h="",b="";c=g.id;g=$(g).prev();f=g.attr("downloadUrl");a=g.attr("appName");b=g.attr("version");h='[{"packageName":"'+c+'","downloadUrl":"'+f+'","appName":"'+a+'","version":"'+b+'"}]';cef.param=h;cef.appStore("downloadApp");return false}function installAllNeedApk(f){if($(f).hasClass("disable")){return}var c="",e="",b="",g="[",d=0,a="";$("#phoneNeedApp_list").find(".pnD").each(function(){f=$(this);a=f.text();if(a=="立即安装"||a=="立即更新"){f.addClass("unable");f.html('<img src="../images/doing.gif"/><span>下载中</span>')}else{return}c=f.attr("id");f=f.prev();e=f.attr("downloadUrl");b=f.attr("appName");if(d!=0){g+=',{"packageName":"'+c+'","downloadUrl":"'+e+'","appName":"'+b+'"}'}else{g+='{"packageName":"'+c+'","downloadUrl":"'+e+'","appName":"'+b+'"}'}d++});if(d!=0){g=g+"]";cef.param=g;cef.appStore("downloadApp")}else{parent.document.getElementById("allIsInstall").style.display="block";setTimeout(function(){parent.document.getElementById("allIsInstall").style.display="none"},1000)}}function setPhoneNeed(h){var g=$("#phoneNeedApp_list");g.empty();var f=0,e="",c="";if(h!=""&&h!=null&&h!="0"){var a=h.appList;for(var d=0;d<a.length;d++){if(d==16){break}f=a[d]["status"];c=getButtonStatus(f,a[d]["csPackageName"]);g.append('<li>                        <div class="pnImg"><img src="'+a[d]["iconUrl"]+'" onerror="appImgError(this)"/></div>                        <div class="pnN"  downloadUrl="'+a[d]["downloadUrl"]+'" version="'+a[d]["versionName"]+'" appName="'+a[d]["titleCN"]+'">'+a[d]["titleCN"]+"</div> "+c+"</div>                    </li>")}g=parent.document.getElementById("installAllNeed");parent.document.getElementById("needRefresh").style.display="block";$(g).removeClass("disable")}else{if(a=="0"){document.getElementById("phoneNeedApp_list").innerHTML='<div class="appBusy">网络异常，加载失败,请尝试 <a style="color:#098FD4;" href="javascript:parent.refreshNeedApk()">刷 新</a></div>'}else{document.getElementById("phoneNeedApp_list").innerHTML='<div class="empty">该页面没有相关应用,请尝试 <a style="color:#098FD4;" href="javascript:parent.refreshNeedApk()">刷 新</a></div>'}g=parent.document.getElementById("installAllNeed");$(g).addClass("disable")}var b=$("#guide").css("display");if((b=="none"||b==undefined)&&parent.global.showPhoneNeed){parent.document.getElementById("phoneNeedAppPop").style.display="block"}}function updateAppstatus(a){if(a!=""&&a!=null&&a!="0"){var c,b;for(var d=0;d<a.length;d++){c=a[d]["status"];b=a[d]["pkgname"];InstallOrUpdateSuccess(c,b)}}}function setIndexTocpic(b){if(global.refreshTime>0){return}global.refreshTime=global.refreshTime+1;if(b!=""&&b!=null&&b!="0"){var a="",e="";for(var c=0;c<b.length;c++){if(c==6){break}e='<li><div class="topic" onclick="getTopicApp(\''+b[c]["imageUrl"]+"','"+b[c]["id"]+"','"+b[c]["topicName"]+"','"+b[c]["info"]+'\')"><img src="'+b[c]["imageUrl"]+'"><div class="topicName">'+b[c]["topicName"]+'</div><div class="topicInfo">'+b[c]["info"]+"<div></div></li>";a+=e}var d=$("#jCarouselLite");d.find("ul").html(a);d.show();d.jCarouselLite({btnNext:"#next",btnPrev:"#prev",auto:2000,speed:500,visible:2,easing:"easeinout"});$(".preNextHide").show();$("#appPrompt").hide();$("#appBusy").hide()}else{global.refreshTime=0;$("#appPrompt").hide();$(".preNextHide").hide();$("#jCarouselLite").hide();$("#appBusy").show()}}function getTopicApp(e,d,b,a){parent.global.cateId="topic";parent.global.appId=d;parent.global.cateName=b;parent.global.huiInfo=a;parent.global.appIconUrl=e;parent.global.page=1;parent.global.arrayType=3;var c=parent.document.getElementById("myIframe");parent.global.refreshPage="category/category.html";$(c).attr("src",parent.global.refreshPage);parent.addHistoryEvent();parent.document.getElementById("phoneNeedAppPop").style.display="none";parent.openVivostore()}function refreshTopicList(){var a="0";cef.param=a;cef.appStore("getTopic")};