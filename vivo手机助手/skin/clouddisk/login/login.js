$(document).ready(function(){$.event.props=$.event.props.join("|").replace("layerX|layerY|","").split("|");global.searchObj=$("#user");global.authConDivObj=$("#authConDiv");$("#user").focus(function(){$(this).parent().css("background","transparent url(images/userIconOn.png) 230px center no-repeat");if($(this).val()==""){showRemName()}}).blur(function(){$(this).parent().css("background","transparent url(images/userIcon.png) 230px center no-repeat")}).keyup(function(){var a=document.getElementById("remUserList");if(a.innerHTML!=""&&$(this).val()==""){a.style.display="block"}else{a.style.display="none"}}).click(function(){return false});$("body").click(function(){hideRemUser()});$("#pass").focus(function(){$(this).parent().css("background","transparent url(images/passIconOn.png) 230px center no-repeat")}).blur(function(){$(this).parent().css("background","transparent url(images/passIcon.png) 230px center no-repeat")});$("#regVarifyCode").focus(function(){document.getElementById("varifyCodePrompt").innerHTML="";$(this).parent().css("background-position-y","-35px")}).blur(function(){$(this).parent().css("background-position-y","0");checkVarifyCode()});$("#regPass").focus(function(){document.getElementById("passPrompt").innerHTML="";$(this).parent().css("background-position-y","-35px")}).blur(function(){$(this).parent().css("background-position-y","0");checkPass()});$("#regSurePass").focus(function(){document.getElementById("usrePassPrompt").innerHTML="";$(this).parent().css("background-position-y","-35px")}).blur(function(){$(this).parent().css("background-position-y","0");checkSurePass()});$("#regEmail").focus(function(){document.getElementById("emailPrompt").innerHTML="";$(this).parent().css("background-position-y","-35px")}).blur(function(){$(this).parent().css("background-position-y","0");global.emailType=1;checkEmail()});$("#findPassEmail").focus(function(){document.getElementById("findPassPrompt").innerHTML="";$(this).parent().css("background-position-y","-35px")}).blur(function(){$(this).parent().css("background-position-y","0");global.emailType=2;checkEmail()});getPortalUrl();$("#portalAccept").click(function(){if($(this).hasClass("portalAcceptOn")){$(this).removeClass("portalAcceptOn");document.getElementById("porttalPrompt").innerHTML='<div class="regError">请先阅读并同意《vivo帐户协议》</div>'}else{$(this).addClass("portalAcceptOn");document.getElementById("porttalPrompt").innerHTML=""}})});window.onload=function(){showLogin()};document.oncontextmenu=new Function("return false;");var global={myIframeObj:"",emailType:"",url:"",searchTxt:"",intervalObj:"",authConDivObj:""};var loginUrl={protocol:"https://",domain:"usrsys.inner.bbk.com"};function searchHandle(){var a=global.searchObj.val();if(a!=global.searchTxt&&a==""){global.searchTxt=a;showRemName()}else{if(a!=""){document.getElementById("remUserList").style.display="none"}else{showRemName()}}}function hideRemUser(){document.getElementById("remUserList").style.display="none"}function init(){showLogin();document.getElementById("loginPrompt").innerText=""}function remPass(a){if(a.className=="remPass"){a.className="remPass remPassOn"}else{a.className="remPass"}}function CheckChinese(a){if(escape(a).indexOf("%u")!=-1){return true}else{return false}}function showReg(){document.getElementById("loginCover").style.display="none";document.getElementById("findPassCover").style.display="none";document.getElementById("phoneRegCover").style.display="none";$("#registerCover").show().find("input").val("");document.getElementById("varifyCodePrompt").innerHTML="";document.getElementById("passPrompt").innerHTML="";document.getElementById("usrePassPrompt").innerHTML="";document.getElementById("emailPrompt").innerHTML="";document.getElementById("porttalPrompt").innerHTML=""}function showLogin(){parent.getCookie();global.authConDivObj.hide();document.getElementById("registerCover").style.display="none";document.getElementById("findPassCover").style.display="none";document.getElementById("phoneRegCover").style.display="none";$("#loginCover").show();var a=document.getElementById("user");a.value="";var b=document.getElementById("pass");b.value="";document.getElementById("loginPrompt").innerHTML=""}function showForget(){document.getElementById("registerCover").style.display="none";document.getElementById("loginCover").style.display="none";document.getElementById("phoneRegCover").style.display="none";document.getElementById("findPassCover").style.display="block";document.getElementById("findPassTable").style.display="block";document.getElementById("findPassSuccessTable").style.display="none";document.getElementById("findPassEmail").value="";document.getElementById("findPassPrompt").innerHTML=""}function showPortal(){$("#portalPop").show()}function getPortalUrl(){$.ajax({type:"get",url:"http://clouddisk/getPortalUrl",dataType:"text",success:function(a){$("#portalIframe").attr("src",a)},error:function(a){$("#portalIframe").attr("src","user_protocal_zh_CN.html")}})}function hidePortal(){$("#portalPop").hide()}function showPhoneReg(){document.getElementById("registerCover").style.display="none";document.getElementById("loginCover").style.display="none";document.getElementById("findPassCover").style.display="none";document.getElementById("phoneRegCover").style.display="block"}function findPassAgain(){document.getElementById("findPassTable").style.display="block";document.getElementById("findPassSuccessTable").style.display="none"}function checkPass(){var b=document.getElementById("regPass").value;var a=document.getElementById("regSurePass").value;if(b==""){document.getElementById("passPrompt").innerHTML='<div class="regError">请填写密码</div>';return false}else{if(b.length<6){document.getElementById("passPrompt").innerHTML='<div class="regError">密码不能少于6位</div>';return false}else{if(b.length>16){document.getElementById("passPrompt").innerHTML='<div class="regError">密码不能多于16位</div>';return false}else{document.getElementById("passPrompt").innerHTML='<div class="regOk"></div>'}}}if(a!=""){checkSurePass()}return true}function checkSurePass(){var b=document.getElementById("regPass").value;var a=document.getElementById("regSurePass").value;if(a==""){document.getElementById("usrePassPrompt").innerHTML='<div class="regError">请填写确认密码</div>';return false}else{if(a!=b){document.getElementById("usrePassPrompt").innerHTML='<div class="regError">密码和确认密码不一致</div>';return false}else{document.getElementById("usrePassPrompt").innerHTML='<div class="regOk"></div>';return true}}}function checkEmail(){var a;var c=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;var b;if(global.emailType==1){b=document.getElementById("emailPrompt");a=document.getElementById("regEmail").value}else{b=document.getElementById("findPassPrompt");a=document.getElementById("findPassEmail").value}if(a==""){b.innerHTML='<div class="regError">请填写邮箱 </div>';return false}else{if(a.length>32){b.innerHTML='<div class="regError">邮箱地址必须在32个字符以内 </div>';return false}else{if(!c.test(a)){b.innerHTML='<div class="regError">邮箱格式错误</div>';return false}else{b.innerHTML='<div class="regOk"></div>';return true}}}}function checkVarifyCode(){var a;var c=/^\d{6}$/;var b;b=document.getElementById("varifyCodePrompt");a=document.getElementById("regVarifyCode").value;if(a==""){b.innerHTML='<div class="regError">请填写验证码 </div>';return false}else{if(!c.test(a)){b.innerHTML='<div class="regError">验证码必须为6位数字</div>';return false}else{b.innerHTML='<div class="regOk"></div>';return true}}}function login(){document.getElementById("remUserList").style.display="none";var a=document.getElementById("user");var g=document.getElementById("pass");var f=document.getElementById("loginPrompt");var h=document.getElementById("loginBtn");var b=a.value;var d=g.value;if(b==""&&d==""){f.innerText="请填写用户名和密码";setTimeout(function(){a.focus()},1000)}else{if(b==""){f.innerText="请填写用户名";setTimeout(function(){a.focus()},1000)}else{if(d==""){f.innerText="请填写密码";setTimeout(function(){g.focus()},1000)}else{f.innerText="";h.innerHTML="登录中...";document.getElementById("disableCover").style.display="block";var c=0;if($("#remPass").hasClass("remPassOn")){c=1}parent.global.userName=b;parent.global.password=d;parent.global.remember=c;var e={};e.user=b;e.pass=d;e.type="login";useAjaxEx(e)}}}}function loginSuccess(a){var c=document.getElementById("loginPrompt");document.getElementById("disableCover").style.display="none";document.getElementById("loginBtn").innerHTML='<a href="javascript:login(this)">登&nbsp;&nbsp;&nbsp;录</a>';global.authConDivObj.hide();if(a!=""&&a!=null){var b=parseInt(a[0]["stat"],10);if(b==200){parent.global.loginIframeObj.hide();parent.loginOk();cef.cloud("getSideBarInfo");if(a[0]["pcstoken"]!=""){cef.cloud("beginGetPcsQuota")}else{console.log("pcstoken is null!");parent.hideDiskInfo()}}else{c.innerText="帐户或密码错误";setTimeout(function(){document.getElementById("user").focus()},1000)}}else{parent.connectFail()}}function register(){var a=$("#regEmail").val();var d=$("#regVarifyCode").val();var c=$("#regPass").val();document.getElementById("disableCover").style.display="block";document.getElementById("registerBtn").innerHTML='<a href="javascript:register()">注册中...</a>';global.emailType=1;var b=$("#portalAccept").hasClass("portalAcceptOn");if(!b){document.getElementById("porttalPrompt").innerHTML='<div class="regError">请先阅读并同意《vivo帐户协议》</div>'}if(b&&checkEmail()&&checkVarifyCode()&&checkPass()&&checkSurePass()){parent.global.userName=a;parent.global.password=c;var e={};e.code=d;e.pass=c;e.email=a;e.type="register";useAjaxEx(e)}else{setTimeout(function(){document.getElementById("disableCover").style.display="none";document.getElementById("registerBtn").innerHTML='<a href="javascript:register()">立即注册</a>'},1000)}}function registerSuccess(a){global.authConDivObj.hide();if(a!=""&&a!=null){var b=parseInt(a[0]["stat"],10);if(b==200){parent.global.loginIframeObj.hide();parent.global.remember=0;var c={};c.user=parent.global.userName;c.pass=parent.global.password;c.type="login";useAjaxEx(c)}else{if(b==512){document.getElementById("emailPrompt").innerHTML='<div class="regError">'+a[0]["msg"]+"</div>"}else{if(b==517){document.getElementById("varifyCodePrompt").innerHTML='<div class="regError">'+a[0]["msg"]+"</div>"}else{document.getElementById("emailPrompt").innerHTML='<div class="regError">网络异常</div>';parent.connectFail()}}}}else{parent.connectFail()}document.getElementById("disableCover").style.display="none";document.getElementById("registerBtn").innerHTML='<a href="javascript:register()">立即注册</a>'}function findPass(){var c=document.getElementById("findPassPrompt");var d=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;var a="";document.getElementById("disableCover").style.display="block";document.getElementById("findPassBtn").innerHTML='<a href="javascript:findPass()">提交中...</a>';a=document.getElementById("findPassEmail").value;if(a==""){setTimeout(function(){c.innerHTML='<div class="regError">请填写Email</div>';document.getElementById("disableCover").style.display="none";document.getElementById("findPassBtn").innerHTML='<a href="javascript:findPass()">提交</a>'},1000);return}else{if(!d.test(a)){setTimeout(function(){c.innerHTML='<div class="regError">Email格式错误</div>';document.getElementById("disableCover").style.display="none";document.getElementById("findPassBtn").innerHTML='<a href="javascript:findPass()">提交</a>'},1000);return}}var b={};b.email=a;b.type="findPass";useAjaxEx(b)}function findPassSuccess(a){var f=document.getElementById("findPassTitle");var d=document.getElementById("findPassStatus");var e=document.getElementById("findPassManager");document.getElementById("disableCover").style.display="none";document.getElementById("findPassBtn").innerHTML='<a href="javascript:findPass()">提交</a>';var c=document.getElementById("findPassEmail").value.toLowerCase();if(a!=""&&a!=null){var b=parseInt(a[0]["stat"],10);if(b==200){document.getElementById("findPassTable").style.display="none";document.getElementById("findPassSuccessTable").style.display="block";f.innerHTML='<div class="findPassSuccessPrompt">发送成功!</div>';d.innerHTML="邮件已经发送到："+c+"<br />请登录邮箱，按照邮件说明操作";global.url=checkEnterEmail(c);if(global.url!=""){e.innerHTML='<div class="loginBtn"><a href="javascript:enterEmail()">进入邮箱</a></div>'}else{e.innerHTML=""}}else{if(b==551){document.getElementById("findPassPrompt").innerHTML='<div class="regError">Email不存在，请重新输入</div>'}else{document.getElementById("findPassTable").style.display="none";document.getElementById("findPassSuccessTable").style.display="block";f.innerHTML='<div class="findPassFailPrompt">发送失败!</div>';d.innerHTML="邮件发送到"+c+"失败<br />请返回找密码界面，重新操作";e.innerHTML='<div class="findPassBtn"><a href="javascript:findPassAgain()">返回，重新操作</a></div>'}}}else{parent.connectFail()}}function getCookieSuccess(g){var f=document.getElementById("user");var j=document.getElementById("pass");var h="";if(g!=""&&g!=null){var e=g.length;for(var b=0;b<e;b++){var d=g[b]["json1"];var c=g[b]["json2"];if(b==0){f.value=d;j.value=c;if(c==""){$("#remPass").removeClass("remPassOn");j.focus()}}h+='<li class="remUserL" onclick="fillRemName(\''+d+"','"+c+'\')"><div class="remName">'+d+'</div><div class="remove" onclick="removeRemName(this,\''+d+"')\"></div></li>"}var a=$("#remUserList");a.html(h);a.find("li").removeClass("remUserLLast").removeClass("remUserLFirst");a.find("li:first").addClass("remUserLFirst");a.find("li:last").addClass("remUserLFirst")}else{$("#remPass").addClass("remPassOn");document.getElementById("remUserList").innerHTML=h;$("#user").focus();f.focus()}}function checkEnterEmail(c){var b=[["163.com","http://mail.163.com/"],["126.com","http://mail.126.com/"],["qq.com","https://mail.qq.com/"],["sina.com","http://mail.sina.com.cn/"],["sina.cn","http://mail.sina.com.cn/"],["vip.sina.com","http://vip.sina.com.cn/"],["msn.com","https://login.live.com/"],["sohu.com","http://mail.sohu.com/"],["gmail.com","https://mail.google.com/"],["hotmail.com","https://login.live.com/"],["yahoo.com","http://mail.cn.yahoo.com/"],["yahoo.com.cn","http://mail.cn.yahoo.com/"],["yahoo.cn","http://mail.cn.yahoo.com/"],["live.cn","https://login.live.com/"],["263.com","http://gmail.263.com/"],["139.com","http://mail.10086.cn/"],["189.com","http://webmail14.189.cn/webmail/"],["tom.com","http://mail.tom.com/"],["21cn.com","http://mail.21cn.com/"],["wo.com.cn","http://mail.wo.com.cn/"]];c=c.split("@");c=c[1];var d=0;url="";var a=b.length;while(d<a){if(c==b[d][0]){url=b[d][1];break}d++}return url}function enterEmail(a){parent.openBrowser(global.url)}function showRemName(){var b=$("#remUserList");var a=b.find("li").length;if(a>0){b.show()}else{b.hide()}}function fillRemName(a,b){document.getElementById("user").value=a;document.getElementById("pass").value=b;if(b==""){document.getElementById("remPass").className="remPass"}else{document.getElementById("remPass").className="remPass remPassOn"}}function removeRemName(c,b){$(c).parent().remove();var d=$("#remUserList");var a=d.find("li").length;d.find("li").removeClass("remUserLLast").removeClass("remUserLFirst");d.find("li:first").addClass("remUserLFirst");d.find("li:last").addClass("remUserLFirst");if(a==0){d.hide()}else{if(a==1){d.find("li").removeClass("remUserLLast").removeClass("remUserLFirst");d.find("li:last").addClass("singleList")}else{if(a==2){d.find("li").removeClass("remUserLLast").removeClass("remUserLFirst");d.find("li:first").addClass("remUserLFirst");d.find("li:last").addClass("remUserLFirst")}}}cef.param=b;cef.cloud("removeUser");window.event.cancelBubble=true}function showBaiduPcsAuth(a){global.authConDivObj.show();global.authConDivObj.append('<iframe class="authIframe" id="authIframe" name="authIframe" src="'+a+'"></iframe>')}function useAjaxEx(b){var a=JSON.stringify(b);$.ajax({type:"post",url:"http://clouddisk/vivoAccount",data:a,dataType:"text",success:function(d){var e=d;if(typeof d=="string"){d="["+d+"]";d=JSON.parse(d)}if(b.type==="register"){registerSuccess(d)}else{if(b.type==="login"){var c='[{"userName":"'+encodeURIComponent(parent.global.userName)+'" , "password":"'+encodeURIComponent(parent.global.password)+'"}]_@_'+e;parent.login(c)}else{if(b.type==="findPass"){findPassSuccess(d)}else{if(b.type==="obtainCode"){obtainVarifyCodeSuccess(d)}}}}},error:function(c){if(b.type==="register"){registerSuccess("")}else{if(b.type==="login"){loginSuccess("")}else{if(b.type==="findPass"){findPassSuccess("")}else{if(b.type==="obtainCode"){obtainVarifyCodeSuccess("")}}}}}})}function obtainVarifyCode(){global.emailType=1;if(!checkEmail()){return}var b=b=document.getElementById("regEmail").value;var d=$("#getCodeBtn");var a=d.find("a");if(d.hasClass("disabled")){return}else{d.addClass("disabled");a.html("正在发送...");var c={};c.email=b;c.type="obtainCode";useAjaxEx(c)}}function obtainVarifyCodeSuccess(b){var g=document.getElementById("varifyCodePrompt");var f=$("#getCodeBtn");var d=f.find("a");if(b!=""&&b!=null){var c=parseInt(b[0]["stat"],10);var h=b[0]["msg"];if(c==200){if(h.indexOf("邮箱")!=-1){h="验证码已发送到您的邮箱"}else{if(h.indexOf("手机")!=-1){h="验证码已发送到您的手机"}}g.innerHTML='<div class="regTips">'+h+"</div>";var e=60;d.html(e+"秒后重新发送");var a=setInterval(function(){if(e>0){d.html(--e+"秒后重新发送")}else{f.removeClass("disabled");d.html("获取验证码");clearInterval(a)}},1000)}else{g.innerHTML='<div class="regError">'+h+"</div>";f.removeClass("disabled");d.html("获取验证码")}}else{g.innerHTML='<div class="regError">网络异常</div>';f.removeClass("disabled");d.html("获取验证码")}};